<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f7f7f8; margin:0; padding:20px; }
    .card { max-width:420px; margin:40px auto; background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:24px; box-shadow:0 10px 20px rgba(0,0,0,0.04); }
    h1 { margin:0 0 16px; font-size:22px; }
    label { display:block; margin:12px 0 6px; font-weight:600; }
    input { width:100%; padding:10px 12px; border:1px solid #d1d5db; border-radius:8px; font-size:14px; }
    button { margin-top:16px; width:100%; background:#111827; color:#fff; border:none; padding:12px; border-radius:8px; font-weight:600; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .msg { margin-top:12px; font-size:14px; }
    .link { margin-top:16px; text-align:center; font-size:14px; }
    .link a { color:#2563eb; text-decoration:none; }
  </style>
  <script>
    async function onSubmit(event) {
      event.preventDefault();
      const form = event.target;
      const submitBtn = document.getElementById('submitBtn');
      const msg = document.getElementById('msg');
      msg.textContent = '';
      submitBtn.disabled = true;

      const payload = {
        username: form.username.value.trim(),
        email: form.email.value.trim(),
        password: form.password.value
      };

      try {
        const res = await fetch('/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(() => ({}));
        if (!res.ok) {
          throw new Error(data.error || data.message || 'Registration failed');
        }

        msg.style.color = 'green';
        msg.textContent = data.message || 'Registered successfully';
        setTimeout(() => { window.location.href = '/me.html'; }, 500);
      } catch (err) {
        msg.style.color = 'crimson';
        msg.textContent = err.message;
      } finally {
        submitBtn.disabled = false;
      }
    }
  </script>
  </head>
  <body>
    <div class="card">
      <h1>Create an account</h1>
      <form onsubmit="onSubmit(event)">
        <label for="username">Username</label>
        <input id="username" name="username" type="text" autocomplete="username" required>

        <label for="email">Email</label>
        <input id="email" name="email" type="email" autocomplete="email" required>

        <label for="password">Password</label>
        <input id="password" name="password" type="password" autocomplete="new-password" required>

        <button id="submitBtn" type="submit">Register</button>
        <div id="msg" class="msg"></div>
      </form>
      <div class="link">Already have an account? <a href="/login.html">Login</a></div>
    </div>
  </body>
  </html>


